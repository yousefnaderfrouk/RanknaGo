# ุฅุตูุงุญ ุนุฑุถ ูุนูููุงุช ุงูุญุฌูุฒุงุช ุงูููุชููุฉ

## ุงููุดููุฉ ๐ด

ูู ุดุงุดุฉ ุงูุญุฌูุฒุงุช ุงูููุชููุฉ (Completed Bookings)ุ ูุงูุช ุชุธูุฑ ุงูุจูุงูุงุช ุงูุชุงููุฉ ุจุดูู ุบูุฑ ุตุญูุญ:

1. โ **Max. power**: ูุงู ูุนุฑุถ ุนุฏุฏ ุงูุดูุงุญู ุจุฏูุงู ูู ุงูููุฉ ุงููุตูู
2. โ๏ธ **Parked For**: ูุฏ ูุง ูุญุณุจ ุงูููุช ุงููุนูู ูู ุจุนุถ ุงูุญุงูุงุช
3. โ๏ธ **Total Paid**: ูุฏ ูุง ูุญุณุจ ุงูุชูููุฉ ุงููุนููุฉ ุจุฏูุฉ

---

## ุงูุฅุตูุงุญ โ

### 1. Max. power - ุงูููุฉ ุงููุตูู

#### ูุจู:
```dart
'maxPower': spotData?['evChargerCount'] ?? 0,  // โ ุนุฏุฏ ุงูุดูุงุญู
```
**ุงููุดููุฉ:** ูุงู ูุนุฑุถ ุนุฏุฏ ุงูุดูุงุญู (ูุซู: 3) ุจุฏูุงู ูู ุงูููุฉ (ูุซู: 22 kW)

#### ุจุนุฏ:
```dart
'maxPower': spotData?['maxChargerPower'] ?? 
            spotData?['evChargingPower'] ?? 
            0,
```
**ุงูุญู:** ุงูุขู ูุนุฑุถ ุงูููุฉ ุงููุนููุฉ ููุดุงุญู

**ูุซุงู:**
```
ูุจู: Max. power: 3 kW    โ (ุฎุทุฃ - ูุฐุง ุนุฏุฏ ุงูุดูุงุญู!)
ุจุนุฏ: Max. power: 22 kW   โ (ุตุญูุญ - ุงูููุฉ ุงููุตูู)
```

---

### 2. Parked For - ุงูููุช ุงููุณุชุฎุฏู

ุงูููุฏ ูุญุณุจ ุงูููุช ุงููุนูู ุจุงูุชุฑุชูุจ ุงูุชุงูู:

#### ุฃ. ูู hoursSpent ุงููุญููุธ (ููุญุฌูุฒุงุช ุงูููุบุงุฉ)
```dart
if (hoursSpent != null) {
  // ูุณุชุฎุฏู ุงููููุฉ ุงููุญููุธุฉ ุนูุฏ ุงูุฅูุบุงุก
}
```

#### ุจ. ูู startTime ู endTime
```dart
else if (startTime != null && endTime != null) {
  final difference = endTime.difference(startTime);
  // ูุญุณุจ ุงููุฑู ุจูู ุงูุจุฏุงูุฉ ูุงูููุงูุฉ
}
```

#### ุฌ. ูู startTime ุญุชู ุงูุขู (ููุญุฌูุฒุงุช ุงููุดุทุฉ)
```dart
else if (startTime != null) {
  final difference = DateTime.now().difference(startTime);
  // ูุญุณุจ ูู ุงูุจุฏุงูุฉ ุญุชู ุงูุขู
}
```

**ุฃูุซูุฉ ุนูู ุงูุนุฑุถ:**
- ุฃูู ูู ุณุงุนุฉ: `"45 mins"`
- ุณุงุนุงุช: `"2 hours"` ุฃู `"2 h 30 min"`
- ุฃูุงู: `"1 day 5 h"`

---

### 3. Total Paid - ุงูุชูููุฉ ุงููุนููุฉ

ุงูููุฏ ูุญุณุจ ุงูุชูููุฉ ุจูุงุกู ุนูู:

#### ููุญุฌูุฒุงุช ุงูููุบุงุฉ:
```dart
if (type == 'canceled') {
  displayAmount = chargeAmount;  // ุงููุจูุบ ุงููุญุชุณุจ ุนูุฏ ุงูุฅูุบุงุก
}
```

#### ููุญุฌูุฒุงุช ุงูููุชููุฉ:
```dart
// ุงูุทุฑููุฉ 1: ูู hoursSpent ุงููุญููุธ
if (hoursSpent != null) {
  displayAmount = pricePerHour * hoursSpent;
}

// ุงูุทุฑููุฉ 2: ูู startTime ู endTime
else if (startTime != null && endTime != null) {
  final hours = difference.inMinutes / 60.0;
  displayAmount = pricePerHour * hours;
}

// ุงูุทุฑููุฉ 3: ูู startTime ุญุชู ุงูุขู
else if (startTime != null) {
  final hours = DateTime.now().difference(startTime).inMinutes / 60.0;
  displayAmount = pricePerHour * hours;
}
```

**ูุซุงู ุนูู ุงูุญุณุงุจ:**
```
Booking started at: Dec 11, 14:45 PM
Current time: Dec 11, 15:17 PM
Duration: 32 minutes = 0.533 hours
Price per hour: EGP 100
Total Paid: EGP 100 ร 0.533 = EGP 53.30
```

---

## ุงูุจูุงูุงุช ูู Firestore

### ููุญุฌูุฒุงุช ุงูููุชููุฉ:
```javascript
{
  status: 'completed',
  startTime: Timestamp,     // ููุช ุงูุจุฏุก
  endTime: Timestamp,       // ููุช ุงูุงูุชูุงุก (ุงุฎุชูุงุฑู)
  pricePerHour: 100.0,      // ุงูุณุนุฑ ุจุงูุณุงุนุฉ
  totalPrice: 200.0,        // ุงูุณุนุฑ ุงููุฏููุน ูุณุจูุงู
  // ... ุจุงูู ุงูุจูุงูุงุช
}
```

### ููุญุฌูุฒุงุช ุงูููุบุงุฉ:
```javascript
{
  status: 'cancelled',
  startTime: Timestamp,
  hoursSpent: 0.533,        // ุงููุฏุฉ ุงููุนููุฉ ุจุงูุณุงุนุงุช
  chargeAmount: 53.30,      // ุงููุจูุบ ุงููุญุชุณุจ
  refundAmount: 46.70,      // ุงููุจูุบ ุงููุณุชุฑุฌุน
  pricePerHour: 100.0,
  totalPrice: 100.0,
  // ... ุจุงูู ุงูุจูุงูุงุช
}
```

### ูููุงูู ุงูุณูุงุฑุงุช:
```javascript
{
  name: "cic parking",
  maxChargerPower: 22,      // ุงูููุฉ ุงููุตูู ุจุงููููููุงุช โ
  evChargingPower: 22,      // ุงุณู ุจุฏูู
  evChargerCount: 3,        // ุนุฏุฏ ุงูุดูุงุญู (ูุฎุชูู!)
  hasEVCharging: true,
  pricePerHour: 100.0,
  // ... ุจุงูู ุงูุจูุงูุงุช
}
```

---

## ุฃูุซูุฉ ุนูู ุงูุนุฑุถ ุงูุตุญูุญ

### ูุซุงู 1: ุญุฌุฒ ููุชูู (32 ุฏูููุฉ)
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Dec 11, 2025         [Completed]    โ
โ 14:45 PM                            โ
โ                                     โ
โ cic parking                     ๐งญ  โ
โ in cic                              โ
โ                                     โ
โ ๐ณ    โก        โฑ๏ธ        ๐ฐ        โ
โ CCCI  Max.power  Parked For Total Paidโ
โ       22 kW      32 mins   EGP 53.30โ
โ       โ ุตุญูุญ    โ ุฏููู   โ ูุญุณูุจ โ
โ                                     โ
โ [View]              [Book Again]    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ูุซุงู 2: ุญุฌุฒ ููุชูู (2 ุณุงุนุฉ ู 15 ุฏูููุฉ)
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Dec 11, 2025         [Completed]    โ
โ 10:00 AM                            โ
โ                                     โ
โ Mall Parking                    ๐งญ  โ
โ City Center                         โ
โ                                     โ
โ ๐ณ    โก        โฑ๏ธ        ๐ฐ        โ
โ CCCI  Max.power  Parked For Total Paidโ
โ       50 kW      2 h 15 min EGP 225.00โ
โ       โ         โ         โ       โ
โ                                     โ
โ [View]              [Book Again]    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ูุซุงู 3: ุญุฌุฒ ููุบู (45 ุฏูููุฉ)
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Dec 10, 2025         [Canceled]     โ
โ 09:00 AM                            โ
โ                                     โ
โ Airport Parking                 ๐งญ  โ
โ Terminal 3                          โ
โ                                     โ
โ ๐ณ    โก        โฑ๏ธ        ๐ฐ        โ
โ CCCI  Max.power  Parked For  Paid   โ
โ       22 kW      45 mins    EGP 75.00โ
โ                                     โ
โ ๐ Refunded: EGP 25.00              โ
โ                                     โ
โ [View]              [Book Again]    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ููููุฉ ุงูุนูู - ุฎุทูุฉ ุจุฎุทูุฉ

### ุนูุฏ ุนุฑุถ ุงูุญุฌุฒ ุงูููุชูู:

1. **ุชุญููู ุงูุจูุงูุงุช ูู Firestore**
   ```dart
   final bookingData = await _firestore
       .collection('reservations')
       .doc(bookingId)
       .get();
   ```

2. **ุฌูุจ ุจูุงูุงุช ุงููููู**
   ```dart
   final spotData = await _firestore
       .collection('parking_spots')
       .doc(spotId)
       .get();
   ```

3. **ุญุณุงุจ ุงูููุช ุงููุณุชุฎุฏู**
   ```dart
   final difference = endTime.difference(startTime);
   final hours = difference.inHours;
   final minutes = difference.inMinutes % 60;
   ```

4. **ุญุณุงุจ ุงูุชูููุฉ**
   ```dart
   final totalHours = difference.inMinutes / 60.0;
   final totalPaid = pricePerHour * totalHours;
   ```

5. **ุนุฑุถ ุงูุจูุงูุงุช**
   ```dart
   Text('Parked For: $hours h $minutes min')
   Text('Total Paid: EGP ${totalPaid.toStringAsFixed(2)}')
   Text('Max. power: ${maxPower} kW')
   ```

---

## ุงูููู ุงูููุนุฏู

- โ `lib/new home/booking_screen.dart` (ุงูุณุทุฑ 187-189)

---

## ุงูููุงุฆุฏ

โ **ุฏูุฉ ุฃุนูู:** ุงูููุฉ ุงููุตูู ุตุญูุญุฉ ุงูุขู  
โ **ูุถูุญ ุฃูุซุฑ:** ุงูููุช ูุงูุชูููุฉ ูุชู ุญุณุงุจููุง ุจุฏูุฉ  
โ **ุดูุงููุฉ ูุงููุฉ:** ุงููุณุชุฎุฏู ูุฑู ุงูุจูุงูุงุช ุงููุนููุฉ  
โ **ุญุณุงุจ ููุฑู:** ุงูุชุญุฏูุซ ูุญุฏุซ ูุญุธูุงู  

---

## ููุงุญุธุงุช ูููุฉ

1. **ูููุทูุฑูู:** ุชุฃูุฏ ูู ูุฌูุฏ ุญูู `maxChargerPower` ุฃู `evChargingPower` ูู Firestore
2. **ุงูุญุฏ ุงูุฃุฏูู:** ุญุชู ูู ุงุณุชุฎุฏู ุฃูู ูู ุณุงุนุฉุ ูุชู ุงูุญุณุงุจ ุจุงูุฏูุงุฆู
3. **ุงูุชูุฑูุจ:** ุงูุชูููุฉ ุชูุนุฑุถ ุจุนุฏุฏ ุนุดุฑููู (ูุซู: EGP 53.30)

---

## ุงูุชุงุฑูุฎ
ุฏูุณูุจุฑ 11ุ 2025

## ุงูุญุงูุฉ
โ ููุชูู ููุนูู










